#+title: Waybar
#+PROPERTY: header-args:jsonc :comments link :tangle-mode (identity #o600) :mkdirp yes
#+PROPERTY: header-args:jsonc+ :tangle ~/.local/share/chezmoi/private_dot_config/waybar/config.jsonc.tmpl
#+PROPERTY: header-args:css :comments link :tangle-mode (identity #o600) :mkdirp yes
#+PROPERTY: header-args:css+ :tangle ~/.local/share/chezmoi/private_dot_config/waybar/style.css.tmpl

* Configuration
#+begin_src jsonc
{
    "layer": "top",
    "height": 36,
    "modules-left": [
        "hyprland/workspaces"
    ],
    "modules-center": ["hyprland/window"],
    "modules-right": [
        "custom/clocked-in",
        "clock#date",
        "clock#time",
        "custom/podpora",
        "custom/platby",
        "custom/updates",
        "pulseaudio",
        "pulseaudio#mic",
        "backlight",
        "battery",
        "custom/media",
        "tray",
        "custom/power",
    ],

    "pulseaudio": {
        "format": "{icon}  {volume} %",
        "format-bluetooth": "{icon}  {volume} % ",
        "format-muted": "",
        "format-icons": {
            "headphone": "",
            "hands-free": "",
            "headset": "",
            "phone": "",
            "portable": "",
            "car": "",
            "default": ["", ""]
        },
        "scroll-step": 5,
        "on-click": "pavucontrol",
        "ignored-sinks": ["Easy Effects Sink"]
    },
    "pulseaudio#mic": {
        "format": "{format_source}",
        "format-source": "",
        "format-source-muted": "",
        "scroll-step": 5,
        "on-click": "wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle",
        "ignored-sinks": ["Easy Effects Sink"]
    },
    "hyprland/window": {
        "max-length": 100,
        "separate-outputs": true,
        "icon": true,
    },
    "hyprland/workspaces": {
        "format": "{name}: {icon}",
        "on-click": "activate",
        "on-scroll-up": "hyprctl dispatch workspace e+1",
        "on-scroll-down": "hyprctl dispatch workspace e-1",
        "format-icons": {
            "1": "",
            "2": "",
            "3": "",
            "4": "",
            "5": "",
            "urgent": "",
            "active": "",
            "default": ""
        },
        "sort-by-number": true,
        "all-outputs": false
    },

    "network": {
        "tooltip": false,
        "format-wifi": "  {essid}",
        "format-ethernet": ""
    },
    "backlight": {
        "tooltip": false,
        "format": " {}%",
        "interval": 1,
        "on-scroll-up": "light -A 5",
        "on-scroll-down": "light -U 5"
    },
    "battery": {
        "states": {
            "good": 95,
            "warning": 30,
            "critical": 20
        },
        "format": "{icon}  {capacity}%",
        "format-charging": " {capacity}%",
        "format-plugged": " {capacity}%",
        "format-alt": "{time} {icon}",
        "format-icons": ["", "", "", "", ""]
    },
    "tray": {
        "icon-size": 18,
        "spacing": 10
    },
    "clock#date": {
		"format":" {:%a %e. %b}",
        "tooltip-format": "<tt><small>{calendar}</small></tt>",
        "calendar": {
                    "mode"          : "year",
                    "mode-mon-col"  : 3,
                    "weeks-pos"     : "right",
                    "on-scroll"     : 1,
                    "on-click-right": "mode",
                    "format": {
                              "months":     "<span color='#ffead3'><b>{}</b></span>",
                              "days":       "<span color='#ecc6d9'><b>{}</b></span>",
                              "weeks":      "<span color='#99ffdd'><b>W{}</b></span>",
                              "weekdays":   "<span color='#ffcc66'><b>{}</b></span>",
                              "today":      "<span color='#ff6699'><b><u>{}</u></b></span>"
                              }
                    },
        "actions":  {
                    "on-click-right": "mode",
                    "on-click-forward": "tz_up",
                    "on-click-backward": "tz_down",
                    "on-scroll-up": "shift_up",
                    "on-scroll-down": "shift_down"
                    }

    },
    "clock#time": {
		"format": "  {:%R}",
    },
    "cpu": {
        "interval": 15,
        "format": " {}%",
        "max-length": 10
    },
    "memory": {
        "interval": 30,
        "format": " {}%",
        "max-length": 10
    },
    "custom/media": {
        "interval": 30,
        "format": "{icon} {}",
        "return-type": "json",
        "max-length": 20,
        "format-icons": {
            "spotify": " ",
            "default": " "
        },
        "escape": true,
        "exec": "$HOME/.config/system_scripts/mediaplayer.py 2> /dev/null",
        "on-click": "playerctl play-pause"
    },
    "custom/launcher": {
        "format": " ",
        "on-click": "rofi -show drun",
        "on-click-right": "killall rofi"
    },
    "custom/power": {
        "format": "⏻",
        "on-click": "bash ~/.config/rofi/leave/leave.sh"
    },
    "custom/updates": {
        "format": " {}",
        "exec": "checkupdates | wc -l",
        "exec-if": "[[ $(checkupdates | wc -l) != 0 ]]",
        "interval": 3600,
    },
    "custom/clocked-in": {
        "format": "󰅓 {text}",
        "interval": 15,
        "return-type": "json",
        "exec": "$HOME/bin/status-clocked_in",
        "on-click": "$HOME/bin/hypr-switch-workspace 3",
        "on-right-click": "xdg-open 'https://projects.igloonet.cz/work_time/index?day=31&month=7&prj=false&user=3&year=2025'"
    },
    "custom/podpora": {
        "format": " {text}",
        "interval": 10,
        "hide-empty-text": true,
        "return-type": "json",
        "exec": "$HOME/bin/waybar-custom-redmine 'https://projects.igloonet.cz/projects/hosting/issues.json?query_id=529'",
        "on-click": "xdg-open 'https://projects.igloonet.cz/projects/hosting/issues?query_id=529'"
    },
    "custom/platby": {
        "format": " {text}",
        "interval": 10,
        "hide-empty-text": true,
        "return-type": "json",
        "exec": "$HOME/bin/waybar-custom-redmine 'https://projects.igloonet.cz/projects/hosting-platby/issues.json?query_id=528'",
        "on-click": "xdg-open 'https://projects.igloonet.cz/projects/hosting-platby/issues?query_id=528'"
    }
}
#+end_src

* Styles
#+begin_src css
/* workaround comment */ * {
  border: none;
  border-radius: 0px;
  font-family: "JetBrainsMono Nerd Font";
  font-weight: bold;
  font-size: 15px;
  min-height: 0;
  transition: 0.3s;
}

window#waybar {
  background: rgba(21, 18, 27, 0);
  color: #cdd6f4;
}

tooltip {
  background: #1e1e2e;
  border-radius: 10px;
  border-width: 1.5px;
  border-style: solid;
  border-color: #11111b;
  transition: 0.3s;
}

#workspaces {
    margin: 2px 0;
}

#workspaces button {
  padding: 5px;
  color: #313244;
  margin-right: 5px;
}

#workspaces button.active {
  color: #a6adc8;
}

#workspaces button.focused {
  color: #a6adc8;
  background: #eba0ac;
  border-radius: 20px;
}

#workspaces button.urgent {
  color: #11111b;
  background: #a6e3a1;
  border-radius: 20px;
}

#workspaces button:hover {
  background: #11111b;
  color: #cdd6f4;
  border-radius: 20px;
}

#tray,
#pulseaudio,
#pulseaudio.mic,
.modules-right widget label {
  background: #1e1e2e;
  opacity: 0.8;
  padding: 0px 10px;
  margin: 2px 0;
  border: 0 solid #181825;
  color: #181825;
}

#workspaces {
  background: #1e1e2e;
  border-radius: 20px;
  margin-left: 5px;
  padding-right: 0px;
  padding-left: 5px;
}

#window {
  border-radius: 20px;
  margin-left: 5px;
  margin-right: 5px;
}

/* padding fix */
#pulseaudio.mic {
  padding-right: 20px;
}

#custom-power {
  padding-right: 14px;
}

/* whole rounded */
#custom-power,
#tray,
#clock,
#custom-media,
#custom-weather,
#custom-updates,
#custom-platby,
#custom-podpora,
#custom-clocked-in {
  border-radius: 20px;
  margin-right: 5px;
  margin-left: 5px;
}
/* rounded left */
#backlight,
#pulseaudio {
  border-radius: 20px 0 0 20px;
  margin-left: 5px;
  border-right: 0;
}
/* rounded right */
#battery,
#pulseaudio.mic {
  border-radius: 0 20px 20px 0;
  margin-right: 5px;
  border-left: 0;
}

/* color group 1 */
#custom-clocked-in.good {
    background-color: #FAB387;
}

/* color group alert */
#pulseaudio.mic,
#custom-podpora.critical,
#custom-platby.critical {
    background-color: #f38ba8;
}

/* color group warning */
#custom-podpora.warning,
#custom-platby.warning {
    background-color: #f9e2af;
}

/* color group 4 */
#pipewire {
    background-color: #94e2d5;
}

/* color group 5 */
#none {
  background-color: #cba6f7;
  color: #181825;
}

/* color group 6 */
#none {
  background-color: #f2cdcd;
}

#custom-power {
  background: #073642;
  color: #f9e2af;
}

/* idle and low priority */
#tray,
#battery,
#backlight,
#pulseaudio,
#pulseaudio.mic.source-muted,
#custom-updates,
#custom-clocked-in.idle,
#custom-podpora.idle,
#custom-platby.idle,
#clock {
  /*background: #1e1e2e;*/
  background: #0D242C;
  color: #FDF6E3;
}

/* events */
#battery.warning,
#battery.critical,
#battery.urgent {
  background-color: #ff0000;
  color: #FFFF00;
}

#battery.charging {
  background-color: #a6e3a1;
  color: #181825;
}


#tray menu menuitem * {
  color: white;
  background: transparent;
}

#tray menu separator {
  border-top: 1px solid black;
  margin-right: 1em;
}
#+end_src

* Scripts for modules
** Status Clocked In
#+begin_src conf :tangle ~/.local/share/chezmoi/bin/executable_status-clocked_in :mkdirp yes :shebang #!/bin/bash
emacs --batch --eval "(progn (require 'server) (princ (format \"%s\\n\" (server-eval-at \"mu\" '(org-clock-current-task-to-waybar-json)))))" || echo '{"text": "", "class": "idle"}'
#+end_src

#+begin_example
if ps -ef | grep 'server-name "m[u]"' > /dev/null; then
   emacs --batch --eval "(progn (require 'server) (princ (format \"%s\\n\" (server-eval-at \"mu\" '(org-clock-current-task-to-waybar-json)))))" || echo '{"text": "", "class": "idle"}'
else
  echo '{"text": "", "class": "idle"}'
fi
#+end_example
